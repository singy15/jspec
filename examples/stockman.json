{
  "systemName": "stockman",
  "dataType": {
    "number": {},
    "text": {},
    "datetime": {}
  },
  "ioType": {
    "$name": "入出力タイプ",
    "DB": {
      "$name": "データベース"
    },
    "FILE": {},
    "MODEL": {}
  },
  "layoutType": {
    "$name": "レイアウトタイプ",
    "RECTANGLE": {},
    "LINE": {}
  },
  "domainType": {
    "id": {
      "$name": "基本ID型",
      "dbType": "bigint",
      "type": "long",
      "ddlOption": "autoincrement",
      "desc": "標準のID型"
    },
    "stockCd": {
      "name": "在庫CD",
      "type": "string",
      "maxLength": 12,
      "minLength": 12,
      "desc": "YYYYMMDDNNNN\nNNNNは連番",
      "dbType": "varchar(12)"
    },
    "itemCd": {
      "name": "品目CD",
      "type": "string",
      "maxLength": 8,
      "minLength": 8,
      "desc": "NNNNNNNN",
      "dbType": "varchar(8)"
    },
    "longName": {
      "name": "名称",
      "type": "string",
      "dbType": "varchar(max)"
    },
    "stockQty": {
      "name": "在庫数量",
      "type": "long",
      "min": 0,
      "max": 999999999,
      "dbType": "numeric(9)"
    },
    "qty": {
      "name": "数量",
      "type": "long",
      "min": -999999999,
      "max": 999999999,
      "dbType": "numeric(9)"
    },
    "placeCd": {
      "name": "場所CD",
      "type": "long",
      "maxLength": 6,
      "minLength": 6,
      "desc": "XXYYYY\n拠点(XX)+場所(YYYY)",
      "dbType": "varchar(6)"
    }
  },
  "viewComponentType": {
    "form": {
      "template": "`<div style=\"background-color:#EFEFEF; border:solid 1px ${type.borderColor}; width:100%; height:100%;\"><div style=\"top:0px; height:30px; background-color:${type.borderColor}; display:flex; justify-content:start; align-items:center; padding-left:5px; \">${(this.label)? this.label : ''}</div></div>`",
      "borderColor": " #99F"
    },
    "textbox": {
      "template": "`<input type=\"text\" style=\"width:100%; height:100%;\" value=\"${(this.label)? this.label : ''}\" />`"
    },
    "button": {
      "template": "`<button style=\"width:100%; height:100%;\">${label}</button>`"
    },
    "label": {
      "template": "`<span style=\"display:flex; justify-content:${(this.textAlign)? this.textAlign : ''}; align-items:center; width:100%; height:100%;\">${(this.label)? this.label : ''}</span>`"
    }
  },
  "stock": {
    "$view": {
      "storeStock": {
        "$component": {
          "form": {
            "type": "#viewComponentType.form",
            "layout": {
              "x": 5,
              "y": 35,
              "width": 605,
              "height": 320
            },
            "label": "在庫入庫"
          },
          "issueDate": {
            "type": "#viewComponentType.textbox",
            "label": "発行日",
            "layout": {
              "type": "#layoutType.RECTANGLE",
              "x": 335,
              "y": 95,
              "width": 200,
              "height": 24
            }
          },
          "description": {
            "type": "#viewComponentType.textbox",
            "label": "備考",
            "layout": {
              "type": "#layoutType.RECTANGLE",
              "x": 315,
              "y": 145,
              "width": 200,
              "height": 24
            }
          },
          "stockCd": {
            "type": "#viewComponentType.textbox",
            "label": "XXXXXXXXXXXX",
            "layout": {
              "type": "#layoutType.RECTANGLE",
              "x": 70,
              "y": 75,
              "width": 100,
              "height": 20
            }
          },
          "labelStockCd": {
            "type": "#viewComponentType.label",
            "layout": {
              "x": 10,
              "y": 75,
              "width": 50,
              "height": 20
            },
            "label": "在庫CD",
            "textAlign": "end"
          },
          "qty": {
            "type": "#viewComponentType.textbox",
            "label": "999999999",
            "layout": {
              "type": "#layoutType.RECTANGLE",
              "x": 70,
              "y": 125,
              "width": 70,
              "height": 20
            }
          },
          "labelQty": {
            "type": "#viewComponentType.label",
            "layout": {
              "x": 10,
              "y": 125,
              "width": 50,
              "height": 20
            },
            "label": "入庫数量",
            "textAlign": "end"
          },
          "itemCd": {
            "type": "#viewComponentType.textbox",
            "layout": {
              "x": 70,
              "y": 100,
              "width": 100,
              "height": 20
            },
            "label": "XXXXXXXX"
          },
          "unnamed2": {
            "type": "#viewComponentType.label",
            "layout": {
              "x": 10,
              "y": 100,
              "width": 50,
              "height": 20
            },
            "label": "品目CD",
            "textAlign": "end"
          }
        }
      },
      "retrieveStock": {
        "$component": {}
      },
      "transferStock": {
        "$component": {}
      }
    },
    "$process": {
      "registerStock": {
        "$input": {
          "stockTransfer": "#stock.$model.stockTransfer"
        },
        "code": "# 在庫取得\n  在庫CDで在庫レコードを取得する。\n\n  ? 1件取得\n    \n    # 在庫更新\n      //TODO\n\n  ? 0件取得\n\n    # 在庫登録\n      //TODO\n\n# 在庫受払登録\n  在庫受払を登録する。\n  {{stock.$io.stockTransfer.insert}}を入力.stockTransferを引数に実行する。\n\n# メッセージ表示\n  登録完了メッセージをメッセージダイアログで表示する。\n",
        "$output": {
          "result": {
            "type": "#dataType.number"
          }
        }
      }
    },
    "$io": {
      "INSERT_SALE": {
        "type": "#ioType.DB",
        "params$": {
          "MODEL": {
            "type": "#stockDomain.models$.SALE"
          }
        },
        "sql": "INSERT INTO SALE \n(SALE_NO,ISSUE_DATE,DESCRIPTION,AMOUNT) \nVALUES (@MODEL.SALE_NO,@MODEL.ISSUE_DATE,@MODEL.DESCRIPTION,@MODEL.AMOUNT)"
      },
      "DELETE_SALE": {
        "type": "#ioType.DB",
        "params$": {
          "MODEL": {
            "type": "#stockDomain.models$.SALE"
          }
        },
        "sql": "DELETE FROM SALE WHERE SALE_NO = @MODEL.SALE_NO"
      },
      "SELECT_SALE": {
        "type": "#ioType.DB",
        "params$": {
          "MODEL": {
            "type": "#stockDomain.models$.SALE"
          }
        },
        "sql": "SELECT * FROM SALE WHERE SALE_NO = @MODEL.SALE_NO"
      },
      "stockTransfer": {
        "name": "在庫受払入出力",
        "insert": {
          "type": "#ioType.DB",
          "$param": {
            "stockTransfer": {
              "type": "#stock.$model.stockTransfer"
            }
          },
          "sql": "INSERT INTO stock_transfer (stock_id, item_id, qty)\nVALUES ($stockTransfer.stockId, $stockTransfer.itemId, $stockTransfer.qty);"
        }
      }
    },
    "$model": {
      "SALE": {
        "SALE_NO": {
          "type": "#dataType.number"
        },
        "ISSUE_DATE": {
          "type": "#dataType.datetime"
        },
        "DESCRIPTION": {
          "type": "#dataType.text"
        },
        "AMOUNT": {
          "type": "#dataType.number"
        }
      },
      "stockTransfer": {
        "transferId": {
          "type": "#domainType.id"
        },
        "stockId": {
          "type": "#domainType.id"
        },
        "itemId": {
          "type": "#domainType.id"
        },
        "qty": {
          "type": "#domainType.qty"
        }
      }
    }
  },
  "$database": {
    "$table": {
      "stock": {
        "name": "在庫",
        "$column": {
          "stock_id": {
            "type": "#domainType.id",
            "name": "在庫ID"
          },
          "stock_cd": {
            "type": "#domainType.stockCd",
            "name": "在庫CD"
          },
          "place_id": {
            "type": "#domainType.id",
            "name": "場所ID"
          },
          "item_id": {
            "type": "#domainType.id",
            "name": "品目ID"
          },
          "qty": {
            "type": "#domainType.stockQty",
            "name": "在庫数量"
          },
          "reservedQty": {
            "type": "#domainType.stockQty",
            "name": "引当数量"
          }
        }
      },
      "stock_transfer": {
        "name": "在庫受払",
        "$column": {
          "stock_transfer_id": {
            "type": "#domainType.id",
            "name": "受払ID"
          },
          "stock_id": {
            "type": "#domainType.id",
            "name": "在庫ID"
          },
          "item_id": {
            "type": "#domainType.id",
            "name": "品目ID"
          },
          "qty": {
            "type": "#domainType.qty",
            "name": "受払数量"
          }
        }
      },
      "item": {
        "name": "品目",
        "$column": {
          "item_id": {
            "type": "#domainType.id",
            "name": "品目ID"
          },
          "item_cd": {
            "type": "#domainType.itemCd",
            "name": "品目CD"
          },
          "name": {
            "type": "#domainType.longName",
            "name": "商品名"
          }
        }
      },
      "place": {
        "name": "場所",
        "$column": {
          "place_id": {
            "type": "#domainType.id",
            "name": "場所ID"
          },
          "place_cd": {
            "type": "#domainType.placeCd",
            "name": "場所CD"
          },
          "name": {
            "type": "#domainType.longName",
            "name": "場所名"
          }
        }
      }
    }
  },
  "$schema": {
    "$view": {
      "type": "object",
      "properties": {
        "$component": {
          "type": "object",
          "properties": {}
        }
      }
    }
  }
}